openapi: 3.0.3
info:
  title: Ringer Business API - Site E911 Record (Individual)
  description: |
    Endpoints for managing an individual E911 record associated with a specific site.
    Allows retrieving, updating, and deleting a specific E911 record, which links a physical address to emergency services.
  version: 1.0.0
  license:
    name: MIT License
    url: https://github.com/teliax/ringer-oapi/blob/main/LICENSE
  contact:
    name: Ringer API Support
    url: https://docs.ringer.tel/support
    email: support@ringer.tel

servers:
  - url: https://api.ringer.tel/v1
    description: Production server

tags:
  - name: Site Features - E911
    description: Managing E911 records and address validation for emergency services for a site.

paths:
  /sites/{siteId}/e911s/{e911Id}:
    parameters:
      - $ref: '../../common_components.yaml#/components/parameters/SiteId'
      - $ref: './index.yaml#/components/parameters/E911IdPath' 
    get:
      tags:
        - Site Features - E911
      summary: Get E911 Record Details
      description: Retrieves detailed information for a specific E911 record by its ID, belonging to the specified site.
      operationId: getSiteE911RecordById
      security:
        - oAuth2: [read]
      responses:
        '200':
          description: Successfully retrieved E911 record details.
          content:
            application/json:
              schema:
                $ref: './index.yaml#/components/schemas/E911Response'
              example:
                id: 19
                site_id: 6
                name: "Main Office E911"
                caller_id_name: "Teliax Office Emergency"
                house_number: "2150"
                street: "West 29th Ave"
                city: "Denver"
                state_province: "CO"
                postal_code: "80211"
                country_code: "US"
                validated: true
                did_number: "+13035550123"
                links: 
        '401':
          $ref: '../../common_components.yaml#/components/responses/UnauthorizedError'
        '403':
          $ref: '../../common_components.yaml#/components/responses/ForbiddenError'
        '404':
          $ref: '../../common_components.yaml#/components/responses/E911NotFoundError'

    put:
      tags:
        - Site Features - E911
      summary: Update E911 Record
      description: |
        Updates the details of an existing E911 record.
        This typically involves providing address information for validation with emergency services.
      operationId: updateSiteE911RecordById
      security:
        - oAuth2: [write]
      requestBody:
        description: E911 record attributes to update.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/E911UpdateRequest'
            example:
              name: "Main Office E911 - Updated"
              caller_id_name: "Teliax Main Office Emergency Line"
              house_number: "2150"
              house_number_suffix: "Suite 100"
              street: "West 29th Avenue"
              city: "Denver"
              state_province: "CO"
              postal_code: "80211"
              country_code: "US"
      responses:
        '200':
          description: E911 record updated and re-validated successfully.
          content:
            application/json:
              schema:
                $ref: './index.yaml#/components/schemas/E911Response'
              example:
                id: 19
                site_id: 6
                name: "Main Office E911 - Updated"
                caller_id_name: "Teliax Main Office Emergency Line"
                house_number: "2150"
                house_number_suffix: "Suite 100"
                street: "West 29th Avenue"
                city: "Denver"
                state_province: "CO"
                postal_code: "80211"
                country_code: "US"
                validated: true 
                did_number: "+13035550123"
                links: 
        '400':
          $ref: '../../common_components.yaml#/components/responses/BadRequestError'
        '401':
          $ref: '../../common_components.yaml#/components/responses/UnauthorizedError'
        '403':
          $ref: '../../common_components.yaml#/components/responses/ForbiddenError'
        '404':
          $ref: '../../common_components.yaml#/components/responses/E911NotFoundError'

    delete:
      tags:
        - Site Features - E911
      summary: Delete E911 Record
      description: |
        Deletes a specific E911 record.
        This action may also unregister the associated address from emergency services.
        Ensure no phone numbers or devices are solely reliant on this E911 record for emergency calling.
      operationId: deleteSiteE911RecordById
      security:
        - oAuth2: [write]
      responses:
        '204':
          description: E911 record deleted successfully. No content is returned.
        '401':
          $ref: '../../common_components.yaml#/components/responses/UnauthorizedError'
        '403':
          $ref: '../../common_components.yaml#/components/responses/ForbiddenError'
        '404':
          $ref: '../../common_components.yaml#/components/responses/E911NotFoundError'
        '409':
          description: Conflict - E911 record cannot be deleted as it is actively linked to essential services.
          content:
            application/json:
              schema:
                $ref: '../../common_components.yaml#/components/schemas/Error' 
              # Example for 409 is already provided inline in the file.

components:
  schemas:
    E911UpdateRequest:
      allOf:
        - $ref: './index.yaml#/components/schemas/E911Core'
      description: Data for updating an existing E911 record. For PUT, all core fields are typically resubmitted.
      example:
        name: "Warehouse E911 Address"
        caller_id_name: "Warehouse Emergency"
        house_number: "789"
        street: "Industrial Pkwy"
        city: "Commerce City"
        state_province: "CO"
        postal_code: "80022"
        country_code: "US"

  securitySchemes:
    oAuth2:
      $ref: '../../common_components.yaml#/components/securitySchemes/oAuth2'

# End of file, ensuring no duplicated components.schemas blocks exist below. 