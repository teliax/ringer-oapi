openapi: 3.0.3
info:
  title: Ringer Business API - Site Location (Individual)
  description: |
    Endpoints for managing an individual physical location associated with a specific site.
    Allows retrieving, updating, and deleting a specific location record.
  version: 1.0.0
  license:
    name: MIT License
    url: https://github.com/teliax/ringer-oapi/blob/main/LICENSE
  contact:
    name: Ringer API Support
    url: https://docs.ringer.tel/support
    email: support@ringer.tel

servers:
  - url: https://api.ringer.tel/v1
    description: Production server

tags:
  - name: Site Features - Locations
    description: Managing physical locations within a site, often used for E911 purposes.

paths:
  /sites/{siteId}/locations/{locationId}:
    parameters:
      - $ref: '../../common_components.yaml#/components/parameters/SiteId'
      - $ref: './index.yaml#/components/parameters/LocationIdPath'
    get:
      tags:
        - Site Features - Locations
      summary: Get Location Details
      description: Retrieves detailed information for a specific location by its ID, belonging to the specified site.
      operationId: getSiteLocationById
      security:
        - oAuth2: [read]
      responses:
        '200':
          description: Successfully retrieved location details.
          content:
            application/json:
              schema:
                $ref: './index.yaml#/components/schemas/LocationResponse'
              example:
                id: 9
                site_id: 6
                name: "Main Office - Denver"
                house_number: "2150"
                house_number_suffix: "Ste 310"
                street: "West 29th Ave"
                city: "Denver"
                state_province: "CO"
                postal_code: "80211"
                country_code: "US"
                caller_id_name: "Teliax Office Denver"
                e911_enabled: true
                e911_id: 123
                updated_by: "system"
                latitude: "39.759000"
                longitude: "-105.015000"
                links: 
        '401':
          $ref: '../../common_components.yaml#/components/responses/UnauthorizedError'
        '403':
          $ref: '../../common_components.yaml#/components/responses/ForbiddenError'
        '404':
          $ref: '../../common_components.yaml#/components/responses/LocationNotFoundError'

    put:
      tags:
        - Site Features - Locations
      summary: Update Location Details
      description: |
        Updates the details of an existing physical location for a site.
        This can include address components, caller ID name for E911, and E911 enablement status.
      operationId: updateSiteLocationById
      security:
        - oAuth2: [write]
      requestBody:
        description: Location attributes to update.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocationUpdateRequest'
            example:
              name: "Main Office - Denver (Renovated)"
              house_number: "2150"
              house_number_suffix: "Suite 310A"
              street: "West 29th Avenue"
              city: "Denver"
              state_province: "CO"
              postal_code: "80211-3200"
              country_code: "US"
              caller_id_name: "Teliax Denver Main"
              e911_enabled: true
      responses:
        '200':
          description: Location updated successfully.
          content:
            application/json:
              schema:
                $ref: './index.yaml#/components/schemas/LocationResponse'
              example:
                id: 9
                site_id: 6
                name: "Main Office - Denver (Renovated)"
                house_number: "2150"
                house_number_suffix: "Suite 310A"
                street: "West 29th Avenue"
                city: "Denver"
                state_province: "CO"
                postal_code: "80211-3200"
                country_code: "US"
                caller_id_name: "Teliax Denver Main"
                e911_enabled: true
                e911_id: 123
                updated_by: "current_user_example"
                latitude: "39.759000"
                longitude: "-105.015000"
                links: 
        '400':
          $ref: '../../common_components.yaml#/components/responses/BadRequestError'
        '401':
          $ref: '../../common_components.yaml#/components/responses/UnauthorizedError'
        '403':
          $ref: '../../common_components.yaml#/components/responses/ForbiddenError'
        '404':
          $ref: '../../common_components.yaml#/components/responses/LocationNotFoundError'

    delete:
      tags:
        - Site Features - Locations
      summary: Delete a Location
      description: |
        Permanently deletes a specific location record from the site.
        Ensure no devices or critical services (like E911 entries) are solely dependent on this location before deleting.
      operationId: deleteSiteLocationById
      security:
        - oAuth2: [write]
      responses:
        '204':
          description: Location deleted successfully. No content is returned.
        '401':
          $ref: '../../common_components.yaml#/components/responses/UnauthorizedError'
        '403':
          $ref: '../../common_components.yaml#/components/responses/ForbiddenError'
        '404':
          $ref: '../../common_components.yaml#/components/responses/LocationNotFoundError'
        '409':
          description: Conflict - Location cannot be deleted, it may be in use by other resources (e.g., E911, devices).
          content:
            application/json:
              schema:
                $ref: '../../common_components.yaml#/components/schemas/Error'

components:
  # Parameters locationId is now defined in index.yaml and referenced above.
  # SiteIdPath is referenced from common_components.yaml

  schemas:
    LocationUpdateRequest:
      allOf:
        - $ref: './index.yaml#/components/schemas/LocationCore'
      description: Data for updating an existing location. All fields are typically resubmitted for a PUT.
      # required: [] # REMOVED - if fields are optional for PUT, otherwise list them based on LocationCore
      example:
        name: "HQ Front Desk - Updated"
        house_number: "123"
        street: "Main St"
        city: "Anytown"
        state_province: "CA"
        postal_code: "90210"
        country_code: "US"
        caller_id_name: "HQ Front Desk Emergency"
        e911_enabled: true

  securitySchemes:
    oAuth2:
      $ref: '../../common_components.yaml#/components/securitySchemes/oAuth2'

# End of file, ensuring no duplicated components.schemas blocks exist below. 