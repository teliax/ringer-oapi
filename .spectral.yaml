extends: [[spectral:oas, all]]

rules:
  # Customize severity of built-in rules
  openapi-tags: error
  operation-tags: error
  operation-operationId: error
  operation-description: error
  
  # Operation responses - fixed to correctly identify 200 responses
  operation-success-response:
    description: Operation must have at least one 2xx or 3xx response
    given: $.paths.*.*.responses
    severity: error
    then:
      function: schema
      functionOptions:
        schema:
          type: object
          properties:
            "200": {}
            "201": {}
            "202": {}
            "203": {}
            "204": {}
            "205": {}
            "206": {}
            "207": {}
            "208": {}
            "226": {}
            "300": {}
            "301": {}
            "302": {}
            "303": {}
            "304": {}
            "305": {}
            "306": {}
            "307": {}
            "308": {}
          minProperties: 1
          patternProperties:
            "^[2-3][0-9][0-9]$": {}

  # Check info object completeness  
  info-contact:
    description: Info object should contain a contact object
    given: $.info
    severity: warn
    then:
      field: contact
      function: truthy
      
  info-description:
    description: Info object should contain a description
    given: $.info
    severity: error
    then:
      field: description
      function: truthy 